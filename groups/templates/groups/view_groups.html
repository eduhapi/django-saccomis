{% extends 'base.html' %}
{% load humanize %}

{% load custom_filters %}

{% block title %}
    View Entities
{% endblock %}

{% block content %}
 {% include 'more_menu_entities.html' %}'

    <div class="container mt-4">
        <h1 class="text-2xl font-bold mb-4">View Entities</h1>
        <div class="row justify-content-center mb-4">
            <div class="col-md-6">
                <input type="text" id="searchInput" onkeyup="searchTable()" placeholder="Search for entities..." class="form-control">
            </div>
        </div>
        <div class="table-responsive">
            <table class="table table-bordered table-hover" id="membersTable">
                <thead class="thead-light">
                    <tr>
                    <th>Group ID</th>
                    <th>Name</th>
                    <th>Office Phone Number</th>
                    <th>Email</th>
                    <th>Savings Amount</th>
                    <th>Share Capital Amount</th>
                    <th>Active Loans</th>
                </tr>
                </thead>
                <tbody>
                {% for group in groups %}
                <tr onclick="window.location='{% url 'groups:entity_profile' group.id %}'" style="cursor: pointer;">
                    <td>{{ group.id }}</td>
                    <td>{{ group.entity_name }}</td>
                    <td>{{ group.office_phone_number }}</td>
                    <td>{{ group.email }}</td>
                    <td>{{ group.account.savings|intcomma }}</td>
                    <td>{{ group.account.share_capital|intcomma }}</td>
                    <td>{{ group_loan_data|get_item:group.id|default:"0"|intcomma }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="8">No groups found.</td>
                </tr>
                {% endfor %}
            </tbody>
            </table>
        </div>
    </div>

    <script>
        function searchTable() {
            var input = document.getElementById("searchInput");
            var filter = input.value.toUpperCase();
            var table = document.getElementById("membersTable");
            var tr = table.getElementsByTagName("tr");
            for (var i = 1; i < tr.length; i++) {
                var matchFound = false;
                var td = tr[i].getElementsByTagName("td");
                for (var j = 0; j < td.length; j++) {
                    if (td[j]) {
                        var txtValue = td[j].textContent || td[j].innerText;
                        if (txtValue.toUpperCase().indexOf(filter) > -1) {
                            matchFound = true;
                            break;
                        }
                    }
                }
                tr[i].style.display = matchFound ? "" : "none";
            }
        }
    </script>
{% endblock %}
